
% Payload, Speed, Fleet Size
% MAYBE ADD loading rate, unloading rate, load threshold
lb = [2,   20, 1, 0]; % , 0.001,
ub = [30,  87, 4, 1];
options = optimset('Display','off');
disp("Beginning Optimization...")
c = clock;
disp(c(4:5))
for i = 1:20000 % run GA multiple times to determine result
%     [xGA_nl(:,i),fGA_nl(i)] = ga(@airship_surrogate_model, length(lb),[],[],[],[],lb,ub,@nlc);
    [xGA_nl(:,i),fGA_nl(i)] = ga(@airship_surrogate_model, length(lb),[],[],[],[],lb,ub,[],options); % seems reasonable
%     xGA_nl(:,i) = fmincon(@airship_surrogate_model,lb,[],[],[],[],lb,ub); % not good
end
[mv,mi] = mink(fGA_nl,10)
minbest = xGA_nl(:,mi)
MEANBEST = round(mean(minbest,2))
meanbest2 = round(mean(round(minbest),2))


figure(1)
plot(1:length(xGA_nl),xGA_nl(1,:))
title('payload')
figure(2)
plot(1:length(xGA_nl),xGA_nl(2,:))
title('speed')
figure(3)
plot(1:length(xGA_nl),xGA_nl(3,:))
title('fleet')
figure(4)
plot(1:length(xGA_nl),xGA_nl(4,:))
title('threshold')
figure(5)
plot(1:length(fGA_nl),fGA_nl)
title('f val')

% format bank
% nlc([5,59,2])

function f = airship_surrogate_model(x)
wB = -0.2; % minimize Impact to Boat Jobs (B/C it's already negative)
wC = -0.2; % maximize Impact to Crops
wF =  0.2; % minimize Impact to Forest
wI = -0.2; % maximize Impact to Farmer Income
wT = -0.2; % maximize Impact to Farmer Time
PAYLOAD = round(x(1));
CRUISESPEED = round(x(2));
FLEETSIZE = round(x(3));
LOADTHRESHOLD = x(4);
if PAYLOAD == 2 && CRUISESPEED == 20 && FLEETSIZE == 4 && LOADTHRESHOLD > 0.5 && LOADTHRESHOLD < 0.53
    stophere = 1;
end

% Neural Models
% LOAD RATE OF O.1
H2_1 = tanh((1.99547395138881 + -0.0205257540988624 * CRUISESPEED + -0.0545473125266202 * FLEETSIZE + 0.112740267576404 * LOADTHRESHOLD + -0.385335757956815 * PAYLOAD));

H2_2 = tanh((3.19823392727884 + -0.00272355147413899 * CRUISESPEED + -2.52293943080691 * FLEETSIZE + 0.22599241435193 * LOADTHRESHOLD + 0.00678782989581515 * PAYLOAD));

H2_3 = tanh((3.35999859321279 + -0.0334144788174743 * CRUISESPEED + -0.546598862111153 * FLEETSIZE + -0.394153430100556 * LOADTHRESHOLD + -0.0342274786454223 * PAYLOAD));

H2_4 = tanh((2.20447735478451 + -0.0337608784071578 * CRUISESPEED + -0.118307195830484 * FLEETSIZE + -0.14671779523251 * LOADTHRESHOLD + 0.267576234310645 * PAYLOAD));

H1_1 = tanh((0.525346102534139 + 4.41148690754115 * H2_1 + 2.53331742807177 * H2_2 + -0.153815982487857 * H2_3 + -2.34098161144609 * H2_4));

H1_2 = tanh((-2.3190075471497 + -1.98633603527582 * H2_1 + -2.65946193912244 * H2_2 + -2.17998098917806 * H2_3 + 3.76981899396701 * H2_4));

H1_3 = tanh((-1.5383979645763 + -6.67843963352066 * H2_1 + 0.72121463251486 * H2_2 + -3.80151977021782 * H2_3 + 5.98822300031356 * H2_4));

H1_4 = tanh((-0.0123021409843621 + -3.52857266010488 * H2_1 + -2.96828819455624 * H2_2 + 0.100429537767634 * H2_3 + 2.14415886781339 * H2_4));

PREDICTED_BOAT_TRIP_LOSS = -1650.04267584 + 1640.81632277762 * H1_1 + -499.411987918841 * H1_2 + -991.139870544365 * H1_3 + 1521.91670205795 * H1_4;


H2_1 = tanh((-0.0544006781154703 + 0.000587699327767715 * CRUISESPEED + 0.0979392899813285 * FLEETSIZE + -0.725560941794595 * LOADTHRESHOLD + -0.0603114571749412 * PAYLOAD));

H2_2 = tanh((2.85390460443979 + -0.0062294597396245 * CRUISESPEED + -0.126934971495239 * FLEETSIZE + -2.39990582418926 * LOADTHRESHOLD + 0.58841272175553 * PAYLOAD));

H2_3 = tanh((-2.16769880645354 + 0.00889766685092563 * CRUISESPEED + 0.345798019786085 * FLEETSIZE + 0.0617871526726443 * LOADTHRESHOLD + 0.0982500939950814 * PAYLOAD));

H2_4 = tanh((1.4145013707433 + -0.0139392077537385 * CRUISESPEED + -0.260960747561498 * FLEETSIZE + -0.069795008722775 * LOADTHRESHOLD + -0.00499901245912068 * PAYLOAD));

H1_1 = tanh((-2.8027985235591 + -0.219767671562853 * H2_1 + -3.27147478022983 * H2_2 + 0.299976793516356 * H2_3 + 9.85341287885504 * H2_4));

H1_2 = tanh((-0.800863230724412 + -3.3683445140737 * H2_1 + 3.38450626682124 * H2_2 + 1.71866595703464 * H2_3 + -0.637897994035606 * H2_4));

H1_3 = tanh((6.44008144268723 + 0.00936625159409731 * H2_1 + -0.389881937844367 * H2_2 + 6.12656549400274 * H2_3 + 1.36254366054535 * H2_4));

H1_4 = tanh((9.51033375562032 + -3.23890769186713 * H2_1 + -6.90799139908028 * H2_2 + 1.76427434322479 * H2_3 + -0.539788160377753 * H2_4));

PREDICTED_CROP_LOSS = -9635.42700592587 + -412.026202684299 * H1_1 + 19134.567629189 * H1_2 + 10810.5731812726 * H1_3 + -20062.7906738723 * H1_4;


H2_1 = tanh((3.1932430775653 + -0.0000001266459603397 * CRUISESPEED + -0.182788392805874 * FLEETSIZE + 0.0000281539718698292 * LOADTHRESHOLD + 0.134766478918473 * PAYLOAD));

H2_2 = tanh((0.0121157602538849 + -0.0000000317864788973 * CRUISESPEED + -0.0297720074699614 * FLEETSIZE + -0.0000017323058111406 * LOADTHRESHOLD + -0.00575002863372342 * PAYLOAD));

H2_3 = tanh((0.94756833312261 + -0.0000000663635705763 * CRUISESPEED + 0.391910125131035 * FLEETSIZE + -0.0000132353538423178 * LOADTHRESHOLD + -0.0425124691458309 * PAYLOAD));

H2_4 = tanh((1.31850484740445 + -0.0000005603757299269 * CRUISESPEED + -0.402916827327457 * FLEETSIZE + 0.0000391382895524125 * LOADTHRESHOLD + -0.103764097802909 * PAYLOAD));

H1_1 = tanh((19.2794572304423 + -24.641888173282 * H2_1 + -0.282606814523342 * H2_2 + 3.78182426962353 * H2_3 + -1.08018566205161 * H2_4));

H1_2 = tanh((-7.78842357420071 + -2.13333944114116 * H2_1 + -8.03761782962493 * H2_2 + 0.419875336717116 * H2_3 + -6.88892719440248 * H2_4));

H1_3 = tanh((-10.7589339522327 + 10.776005747092 * H2_1 + 0.512260915424563 * H2_2 + 0.24930175078527 * H2_3 + -0.100227808470531 * H2_4));

H1_4 = tanh((71.1918508501906 + -68.1277954374034 * H2_1 + 6.97335796093327 * H2_2 + 0.105181378763574 * H2_3 + 1.31533278106789 * H2_4));

PREDICTED_FOREST_LOSS = 22366.4090021635 + 4639.80488307762 * H1_1 + 8069.32027962552 * H1_2 + 35681.0576832998 * H1_3 + -13126.8443520424 * H1_4;


H2_1 = tanh((-0.886506763686248 + 0.0137222794191545 * CRUISESPEED + -0.00538662145834114 * FLEETSIZE + -0.377962172926502 * LOADTHRESHOLD + 0.0494302447802627 * PAYLOAD));

H2_2 = tanh((-1.34715536925614 + 0.00303851468197287 * CRUISESPEED + 0.061476689300005 * FLEETSIZE + 0.115793302140904 * LOADTHRESHOLD + -0.0105594479661857 * PAYLOAD));

H2_3 = tanh((-2.82929056711381 + 0.0225415596325404 * CRUISESPEED + 0.34367468716424 * FLEETSIZE + 0.303469153884633 * LOADTHRESHOLD + -0.0141605462067196 * PAYLOAD));

H2_4 = tanh((-2.56208240490106 + 0.0227176981551581 * CRUISESPEED + 0.378734361313532 * FLEETSIZE + -0.525885228173521 * LOADTHRESHOLD + 0.415791799376573 * PAYLOAD));

H1_1 = tanh((0.443038308595254 + -3.54756610703438 * H2_1 + 1.73709708456582 * H2_2 + 11.1008353279583 * H2_3 + -9.39144017671603 * H2_4));

H1_2 = tanh((2.464803546799 + -0.240699769987717 * H2_1 + -3.86711142265507 * H2_2 + 5.28902379872298 * H2_3 + -0.263763855155062 * H2_4));

H1_3 = tanh((-0.788448338160103 + 4.89328756559909 * H2_1 + -0.982957396986464 * H2_2 + 1.74100109276115 * H2_3 + -4.77649050476498 * H2_4));

H1_4 = tanh((-12.2887604262614 + -0.64076448299104 * H2_1 + -16.788210027872 * H2_2 + 1.91263457919701 * H2_3 + -0.0803052821122917 * H2_4));

PREDICTED_INCOME = 311808.276087099 + -934368.211634944 * H1_1 + -909640.306754743 * H1_2 + -542399.790987736 * H1_3 + -746355.066793217 * H1_4;


H2_1 = tanh((1.11989350608431 + -0.00928385604225976 * CRUISESPEED + -0.406629675054042 * FLEETSIZE + -1.0033950376605 * LOADTHRESHOLD + 0.00745298732678373 * PAYLOAD));

H2_2 = tanh((1.19370191200273 + -0.00838545773433328 * CRUISESPEED + -0.267515956226759 * FLEETSIZE + -0.285678323703361 * LOADTHRESHOLD + 0.323589773124413 * PAYLOAD));

H2_3 = tanh((-0.434882169757047 + 0.00406465330825467 * CRUISESPEED + 0.362476141713409 * FLEETSIZE + -0.906205724695661 * LOADTHRESHOLD + 0.0173380216038568 * PAYLOAD));

H2_4 = tanh((-0.202573536172438 + 0.025428979505852 * CRUISESPEED + -0.0894082590371017 * FLEETSIZE + -0.750321935231274 * LOADTHRESHOLD + -0.0202357536607241 * PAYLOAD));

H1_1 = tanh((-1.77983469006482 + -2.48529527626471 * H2_1 + 2.21705210307087 * H2_2 + 1.71764356083732 * H2_3 + 0.730642915980956 * H2_4));

H1_2 = tanh((-0.17435877789626 + -0.250168801425146 * H2_1 + 2.65670611755327 * H2_2 + 2.36198106479465 * H2_3 + 0.646429720656883 * H2_4));

H1_3 = tanh((-0.725879002201009 + -0.223138285111941 * H2_1 + 3.05220059663869 * H2_2 + 2.25588770976821 * H2_3 + 0.692427546267482 * H2_4));

H1_4 = tanh((2.13271917841614 + 2.3708173794352 * H2_1 + -2.69842733095026 * H2_2 + -1.66029004177214 * H2_3 + -0.69469259864981 * H2_4));

PREDICTED_TIME_SAVINGS = -1082.85750216594 + -24478.2209237185 * H1_1 + 23110.6137348266 * H1_2 + -18730.5944807667 * H1_3 + -29927.6836807146 * H1_4;


% LOAD RATE OF 0.2
% H2_1 = tanh((-6.42134510832478 + -0.0335137519483039 * CRUISESPEED + 1.64040576045017 * FLEETSIZE + -0.065498283539485 * LOADTHRESHOLD + 0.550431395617194 * PAYLOAD));
% 
% H2_2 = tanh((-4.48282167945162 + -0.0626318339250193 * CRUISESPEED + 1.5283643008947 * FLEETSIZE + -0.149234326136545 * LOADTHRESHOLD + 0.399572576674482 * PAYLOAD));
% 
% H2_3 = tanh((-1.95744037599886 + 0.0108184067465871 * CRUISESPEED + 0.00171804383545419 * FLEETSIZE + -0.108608550269949 * LOADTHRESHOLD + 0.809061733938094 * PAYLOAD));
% 
% H2_4 = tanh((-2.8294750203499 + 0.0146037351331018 * CRUISESPEED + 0.99595649730111 * FLEETSIZE + 0.0494110756189092 * LOADTHRESHOLD + 0.00309494699164287 * PAYLOAD));
% 
% H1_1 = tanh((1.72441112346725 + 4.09014686251623 * H2_1 + -2.87242242049816 * H2_2 + 0.178876478045473 * H2_3 + 0.318987074214656 * H2_4));
% 
% H1_2 = tanh((6.41136407401151 + -3.18530760367423 * H2_1 + 2.26145600868182 * H2_2 + 5.05113932150756 * H2_3 + 13.2358470881335 * H2_4));
% 
% H1_3 = tanh((1.38001855090345 + 0.400658573123178 * H2_1 + -0.166886812536547 * H2_2 + -1.30343613467284 * H2_3 + -0.105658587226154 * H2_4));
% 
% H1_4 = tanh((-0.222199858219582 + -5.97497335852798 * H2_1 + 4.80841399490352 * H2_2 + -2.08205683822553 * H2_3 + -1.02963215350667 * H2_4));
% 
% PREDICTED_BOAT_TRIP_LOSS = -2088.50477266085 + 975.864702441098 * H1_1 + -339.849719796163 * H1_2 + -189.01632534772 * H1_3 + 1759.6197657845 * H1_4;
% 
% 
% H2_1 = tanh((-3.06517907420794 + 0.012395027605557 * CRUISESPEED + 1.53619693491052 * FLEETSIZE + 0.00860642275457639 * LOADTHRESHOLD + 0.0318440101967264 * PAYLOAD));
% 
% H2_2 = tanh((-1.47605940534488 + 0.00399800732720037 * CRUISESPEED + 0.188692030665661 * FLEETSIZE + 1.67445132246994 * LOADTHRESHOLD + 0.297246772863941 * PAYLOAD));
% 
% H2_3 = tanh((-0.800515885288202 + 0.000397886248836458 * CRUISESPEED + 0.0164329924097395 * FLEETSIZE + 0.790028472898968 * LOADTHRESHOLD + -0.30064719487204 * PAYLOAD));
% 
% H2_4 = tanh((2.5421836247585 + -0.0767202515337179 * CRUISESPEED + -0.224485868477965 * FLEETSIZE + -0.694463722159518 * LOADTHRESHOLD + 0.0200929109695754 * PAYLOAD));
% 
% H1_1 = tanh((0.553166275471469 + 0.143509344368304 * H2_1 + 0.317883201562942 * H2_2 + 0.419405111022534 * H2_3 + -0.245070993312589 * H2_4));
% 
% H1_2 = tanh((-1.29762366836698 + 0.322135976518953 * H2_1 + 0.302068377901551 * H2_2 + -1.65623528355904 * H2_3 + -0.23751688642468 * H2_4));
% 
% H1_3 = tanh((-0.406807053030155 + 0.115196077367978 * H2_1 + -0.0134539339299573 * H2_2 + -1.40808473943364 * H2_3 + 0.0545849086398317 * H2_4));
% 
% H1_4 = tanh((3.35397636623038 + 0.172907518648964 * H2_1 + -2.61307823115138 * H2_2 + 8.59330077427202 * H2_3 + -0.19536205696897 * H2_4));
% 
% PREDICTED_CROP_LOSS = -2379.37494923729 + -3465.16941166458 * H1_1 + 4631.50111035766 * H1_2 + -5743.22942898667 * H1_3 + -6007.87428588556 * H1_4;
% 
% 
% H2_1 = tanh((3.1932430775653 + -0.0000001266459603397 * CRUISESPEED + -0.182788392805874 * FLEETSIZE + 0.0000281539718698292 * LOADTHRESHOLD + 0.134766478918473 * PAYLOAD));
% 
% H2_2 = tanh((0.0121157602538849 + -0.0000000317864788973 * CRUISESPEED + -0.0297720074699614 * FLEETSIZE + -0.0000017323058111406 * LOADTHRESHOLD + -0.00575002863372342 * PAYLOAD));
% 
% H2_3 = tanh((0.94756833312261 + -0.0000000663635705763 * CRUISESPEED + 0.391910125131035 * FLEETSIZE + -0.0000132353538423178 * LOADTHRESHOLD + -0.0425124691458309 * PAYLOAD));
% 
% H2_4 = tanh((1.31850484740445 + -0.0000005603757299269 * CRUISESPEED + -0.402916827327457 * FLEETSIZE + 0.0000391382895524125 * LOADTHRESHOLD + -0.103764097802909 * PAYLOAD));
% 
% H1_1 = tanh((19.2794572304423 + -24.641888173282 * H2_1 + -0.282606814523342 * H2_2 + 3.78182426962353 * H2_3 + -1.08018566205161 * H2_4));
% 
% H1_2 = tanh((-7.78842357420071 + -2.13333944114116 * H2_1 + -8.03761782962493 * H2_2 + 0.419875336717116 * H2_3 + -6.88892719440248 * H2_4));
% 
% H1_3 = tanh((-10.7589339522327 + 10.776005747092 * H2_1 + 0.512260915424563 * H2_2 + 0.24930175078527 * H2_3 + -0.100227808470531 * H2_4));
% 
% H1_4 = tanh((71.1918508501906 + -68.1277954374034 * H2_1 + 6.97335796093327 * H2_2 + 0.105181378763574 * H2_3 + 1.31533278106789 * H2_4));
% 
% PREDICTED_FOREST_LOSS = 22366.4090021635 + 4639.80488307762 * H1_1 + 8069.32027962552 * H1_2 + 35681.0576832998 * H1_3 + -13126.8443520424 * H1_4;
% 
% 
% H2_1 = tanh((-2.85512413130783 + -0.0122080604609652 * CRUISESPEED + -0.23260098007093 * FLEETSIZE + -0.0945417412742535 * LOADTHRESHOLD + -0.00484564829146768 * PAYLOAD));
% 
% H2_2 = tanh((10383.8901394607 + 0.00510491180122147 * CRUISESPEED + -0.0568440691627369 * FLEETSIZE + -10389.234815202 * LOADTHRESHOLD + 8.89371670256258 * PAYLOAD));
% 
% H2_3 = tanh((-3.31584530879413 + 0.0231741859625825 * CRUISESPEED + 0.323704011161717 * FLEETSIZE + -0.109004266658532 * LOADTHRESHOLD + 0.0373154526658307 * PAYLOAD));
% 
% H2_4 = tanh((0.996726789047432 + 0.00502192573461742 * CRUISESPEED + 0.692204334162246 * FLEETSIZE + 0.0215271812361072 * LOADTHRESHOLD + 0.907210429564784 * PAYLOAD));
% 
% H1_1 = tanh((5188.50825267391 + 1206.82864744607 * H2_1 + -3897.10753708738 * H2_2 + 1.51814710706846 * H2_3 + -84.9744291595599 * H2_4));
% 
% H1_2 = tanh((1506.82048396677 + -2184.39986059829 * H2_1 + -649.052163271479 * H2_2 + -0.308751273150785 * H2_3 + -3040.76579717134 * H2_4));
% 
% H1_3 = tanh((2243.88132890138 + -5078.6306747085 * H2_1 + -5488.45699494394 * H2_2 + 4.2862122666905 * H2_3 + -1836.22134898393 * H2_4));
% 
% H1_4 = tanh((4020.82513530416 + -2211.46276369956 * H2_1 + -1929.28856087255 * H2_2 + -1969.93598002083 * H2_3 + -1448.97983926184 * H2_4));
% 
% PREDICTED_INCOME = 954422.59419029 + -437246.713850943 * H1_1 + -219779.415586567 * H1_2 + -346026.90980269 * H1_3 + -322702.137316477 * H1_4;
% 
% 
% H2_1 = tanh((1.42120160050774 + -0.0417591115473455 * CRUISESPEED + 1.14228153434132 * FLEETSIZE + -0.281297322147062 * LOADTHRESHOLD + 0.0414229088757333 * PAYLOAD));
% 
% H2_2 = tanh((-0.3142767018467 + 0.00670553693312963 * CRUISESPEED + 0.316092758505886 * FLEETSIZE + -0.0901949768826895 * LOADTHRESHOLD + -0.559818117447199 * PAYLOAD));
% 
% H2_3 = tanh((0.262387484204695 + 0.000275416324737363 * CRUISESPEED + 0.0148098094737221 * FLEETSIZE + -0.671343317490916 * LOADTHRESHOLD + 0.247347004386378 * PAYLOAD));
% 
% H2_4 = tanh((-0.309389464588639 + 0.0109754725684399 * CRUISESPEED + 0.317229080520209 * FLEETSIZE + 0.11087654906088 * LOADTHRESHOLD + 0.000593544249162053 * PAYLOAD));
% 
% H1_1 = tanh((1.15116740581231 + 0.00857248682342124 * H2_1 + -0.154768662019481 * H2_2 + 0.173410072123276 * H2_3 + -0.838224271418963 * H2_4));
% 
% H1_2 = tanh((-3.8962767543842 + 0.512659804106422 * H2_1 + -1.29969507903056 * H2_2 + 0.569538071128462 * H2_3 + 5.02618648411059 * H2_4));
% 
% H1_3 = tanh((0.262255403045179 + 0.0301595119171817 * H2_1 + 0.228783117685264 * H2_2 + -0.313989761438902 * H2_3 + 1.31588644390008 * H2_4));
% 
% H1_4 = tanh((-3.64568456658982 + 0.26670709883138 * H2_1 + 0.0467534373370621 * H2_2 + -10.0937811662325 * H2_3 + 2.64449262503928 * H2_4));
% 
% PREDICTED_TIME_SAVINGS = 2796.65845779394 + -6259.19216610223 * H1_1 + 4566.50336442908 * H1_2 + -5218.25506895857 * H1_3 + -8789.57809723696 * H1_4;

% normalize impacts based on simulation max and mins
bshift = 0;
bnorm = 3260 + bshift;
cshift = 2554;
cnorm = cshift + 658;
fshift = -582;
fnorm = 25000 + fshift;
ishift = 290000;
inorm = ishift + 1384000;
tshift = 1588;
tnorm = 8411 + tshift;

BoatJobLoss = ((PREDICTED_BOAT_TRIP_LOSS) + bshift) /(bnorm);

Crops = ((PREDICTED_CROP_LOSS) + cshift)/(cnorm);

ForestLoss = ((PREDICTED_FOREST_LOSS) + fshift)/(fnorm);

Income = ((PREDICTED_INCOME) + ishift)/(inorm);

TimeSavings = ((PREDICTED_TIME_SAVINGS) + tshift)/ (tnorm);

% weight and sum impacts
f = wB * BoatJobLoss + wC * Crops + wF * ForestLoss + wI * Income + wT * TimeSavings;
end


function [c,ceq] = nlc(x)
% No constraints needed to define feasible space since cities are close
%   enough that all designs are feasible
Payload = round(x(1));
CruiseSpeed = round(x(2));
FleetSize = round(x(3));
PayloadFraction = 0.3;
FuelTankFraction = 0.05;
FinenessRatio = 3;
ConstraintSize = 81000;


% footprint constraint
totalLift_lb = 2000 * Payload / PayloadFraction;
liftLbPerCubicFoot = 0.06; % helium
specificDensity = 0.95; % at ~1500 ft
airshipVolume_ft3 = (totalLift_lb / liftLbPerCubicFoot) / specificDensity;
diameter_ft = 0.3048 * (4*airshipVolume_ft3 / (0.6 * pi * FinenessRatio))^(1/3) % m # not using percent cylinder
length_ft = diameter_ft * FinenessRatio % m
footprint_ft2 = length_ft * diameter_ft;

FootprintConstraint = footprint_ft2 * FleetSize * 1.1 - ConstraintSize; % this equivalent to forrestloss being below a size


c(:,1) = FootprintConstraint;
ceq = [];
end




















