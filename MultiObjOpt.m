
% Payload, Speed, Fleet Size
% MAYBE ADD loading rate, unloading rate, goods transported threshold for choose_city, ?average city distance?
lb = [1,   20, 1]; % , 0.001,
ub = [30, 100, 5];

for i = 1:100 % run GA multiple times to determine result
%     [xGA_nl(:,i),fGA_nl(i)] = ga(@airship_surrogate_model, length(lb),[],[],[],[],lb,ub,@nlc);
    [xGA_nl(:,i),fGA_nl(i)] = ga(@airship_surrogate_model, length(lb),[],[],[],[],lb,ub); % seems reasonable
%     xGA_nl(:,i) = fmincon(@airship_surrogate_model,lb,[],[],[],[],lb,ub); % not good
end
MEANBEST = round(mean(xGA_nl,2))
meanbest2 = round(mean(round(xGA_nl),2))

format bank
nlc([5,59,2])
function f = airship_surrogate_model(x)
wB =  0.2; % minimize Impact to Boat Jobs
wC = -0.2; % maximize Impact to Crops
wF =  0.2; % minimize Impact to Forest
wI = -0.2; % maximize Impact to Farmer Income
wT = -0.2; % maximize Impact to Farmer Time
Payload = round(x(1));
CruiseSpeed = round(x(2));
FleetSize = round(x(3));

% normalize impacts based on simulation max and mins
bshift = 628;
bnorm = 3260-bshift;
cshift = 1600;
cnorm = cshift+660;
fshift = -582;
fnorm = 12434+fshift;
ishift = 120345.7677;
inorm = ishift+516184.25639;
tshift = -980;
tnorm = 8727 + tshift;

BoatJobLoss = (bshift+(1290.40740062606 + -2463.57013231398 * tanh(...
    0.5 * (1.64836351431187 + -0.375099869118689 *...
    tanh(0.5 * ((-4.12072343934788) + -0.0296850070801968 * Payload...
    +0.116159501175274 * CruiseSpeed + 1.45498683828063 * FleetSize)...
    ) + -0.312385743781306 * tanh(...
    0.5 * ((-2.15394841236735) + 0.470588126087132 * Payload...
    +0.00692427459395683 * CruiseSpeed + 0.557593950365479 * FleetSize)...
    ) + 0.0566784741768478 * tanh(...
    0.5 * (2.58530366505728 + -0.105001177196863 * Payload + 0.0427984817435845...
    * CruiseSpeed + -1.55436098571991 * FleetSize)...
    ))...
    ) + -1021.86024543094 * tanh(...
    0.5 * ((-0.971878382490007) + 2.59199326030847 *...
    tanh(0.5 * ((-4.12072343934788) + -0.0296850070801968 * Payload...
    +0.116159501175274 * CruiseSpeed + 1.45498683828063 * FleetSize)...
    ) + 1.34219397442602 * tanh(...
    0.5 * ((-2.15394841236735) + 0.470588126087132 * Payload...
    +0.00692427459395683 * CruiseSpeed + 0.557593950365479 * FleetSize)...
    ) + -0.615506212164544 * tanh(...
    0.5 * (2.58530366505728 + -0.105001177196863 * Payload + 0.0427984817435845...
    * CruiseSpeed + -1.55436098571991 * FleetSize)...
    ))...
    ) + 2535.02466049076 * tanh(...
    0.5 * ((-2.09157854655427) + 0.673558565897487 *...
    tanh(0.5 * ((-4.12072343934788) + -0.0296850070801968 * Payload...
    +0.116159501175274 * CruiseSpeed + 1.45498683828063 * FleetSize)...
    ) + -5.33293999268777 * tanh(...
    0.5 * ((-2.15394841236735) + 0.470588126087132 * Payload...
    +0.00692427459395683 * CruiseSpeed + 0.557593950365479 * FleetSize)...
    ) + -1.44954598768364 * tanh(...
    0.5 * (2.58530366505728 + -0.105001177196863 * Payload + 0.0427984817435845...
    * CruiseSpeed + -1.55436098571991 * FleetSize))))))/(bnorm);

Crops = (cshift+((-3109.98671615202) + 1948.03474512518 * tanh(...
    0.5 * (1.51470431896469 + -0.347814511679911 *...
    tanh( 0.5 * ((-3.7409014435391) + -0.00910264700639563 * Payload...
    +0.0978777958317855 * CruiseSpeed + 1.19915208042833 * FleetSize)...
    ) + -0.275786205315457 * tanh(...
    0.5 * ((-2.44368888525542) + 0.468857245771876 * Payload...
    +0.00558251225588035 * CruiseSpeed + 0.606170925182067 * FleetSize)...
    ) + 0.0789878539300532 * tanh(...
    0.5 * (1.86303240877353 + -0.0289342410836232 * Payload...
    +0.0374451170040737 * CruiseSpeed + -1.12599389123208 * FleetSize)))...
    ) + 830.940670570293 * tanh(...
    0.5 * ((-0.187036527488219) + 2.64201717957423 *...
    tanh( 0.5 * ((-3.7409014435391) + -0.00910264700639563 * Payload...
    +0.0978777958317855 * CruiseSpeed + 1.19915208042833 * FleetSize)...
    ) + 1.10334554944447 * tanh(...
    0.5 * ((-2.44368888525542) + 0.468857245771876 * Payload...
    +0.00558251225588035 * CruiseSpeed + 0.606170925182067 * FleetSize)...
    ) + -1.04340072589616 * tanh(...
    0.5 * (1.86303240877353 + -0.0289342410836232 * Payload...
    +0.0374451170040737 * CruiseSpeed + -1.12599389123208 * FleetSize)))...
    ) + -2169.05882416857 * tanh(...
    0.5 * ((-2.04985793924961) + 0.561883932002526 *...
    tanh( 0.5 * ((-3.7409014435391) + -0.00910264700639563 * Payload...
    +0.0978777958317855 * CruiseSpeed + 1.19915208042833 * FleetSize)...
    ) + -4.63845512751975 * tanh(...
    0.5 * ((-2.44368888525542) + 0.468857245771876 * Payload...
    +0.00558251225588035 * CruiseSpeed + 0.606170925182067 * FleetSize)...
    ) + -1.84628696280192 * tanh(...
    0.5 * (1.86303240877353 + -0.0289342410836232 * Payload...
    +0.0374451170040737 * CruiseSpeed + -1.12599389123208 * FleetSize)))) ))/(cnorm);

ForestLoss = (((-39976.1277201405) + 4688.75088157582 * tanh(...
    0.5 * ((-25.8415615077367) + 24.9302547174872 *...
    tanh( 0.5 * ((-0.238197348348638) + 0.00721958623970009 * Payload...
    +0.0000001887281319316 * CruiseSpeed + -0.0395067302066785 * FleetSize)...
    ) + -30.251136001507 * tanh(...
    0.5 * ((-7.30634023563665) + -0.408568559774739 * Payload...
    +0.0000075828602125249 * CruiseSpeed + 1.44359786144058 * FleetSize)...
    ) + -0.932261059796811 * tanh(...
    0.5 * (4.22336378813332 + -0.0439515375380256 * Payload +...
    -0.0000018527563820437 * CruiseSpeed + -0.658731815848973 * FleetSize)...
    ))...
    ) + 5824.21815329908 * tanh(...
    0.5 * ((-24.1133992867633) + -28.8774725409054 *...
    tanh( 0.5 * ((-0.238197348348638) + 0.00721958623970009 * Payload...
    +0.0000001887281319316 * CruiseSpeed + -0.0395067302066785 * FleetSize)...
    ) + -28.3579245612343 * tanh(...
    0.5 * ((-7.30634023563665) + -0.408568559774739 * Payload...
    +0.0000075828602125249 * CruiseSpeed + 1.44359786144058 * FleetSize)...
    ) + -7.99528839152145 * tanh(...
    0.5 * (4.22336378813332 + -0.0439515375380256 * Payload +...
    -0.0000018527563820437 * CruiseSpeed + -0.658731815848973 * FleetSize)...
    ))...
    ) + -50382.9919203737 * tanh(...
    0.5 * ((-11.0436482984751) + -5.1042837151751 *...
    tanh( 0.5 * ((-0.238197348348638) + 0.00721958623970009 * Payload...
    +0.0000001887281319316 * CruiseSpeed + -0.0395067302066785 * FleetSize)...
    ) + -6.29269809727969 * tanh(...
    0.5 * ((-7.30634023563665) + -0.408568559774739 * Payload...
    +0.0000075828602125249 * CruiseSpeed + 1.44359786144058 * FleetSize)...
    ) + 2.14854895093333 * tanh(...
    0.5 * (4.22336378813332 + -0.0439515375380256 * Payload +...
    -0.0000018527563820437 * CruiseSpeed + -0.658731815848973 * FleetSize) )) ))+ fshift)/(fnorm);

Income = (( (-954731.396953477) + 1350813.91467689 * tanh(...
    0.5 * ((-40.7974066212426) + 12.7733928250648 *...
    tanh( 0.5 * (0.937058060524971 + -0.00599946669774586 * Payload +...
    -0.0297780775975021 * CruiseSpeed + -0.268560898749955 * FleetSize)...
    ) + -2.30678645130494 * tanh(...
    0.5 * ((-0.437664036426991) + 0.0792966702177669 * Payload...
    +0.00548137514862233 * CruiseSpeed + 0.0572969143170224 * FleetSize)...
    ) + 56.2709781573526 * tanh(...
    0.5 * (1.42393947950632 + 0.0109995141437787 * Payload + 0.0229411807146299...
    * CruiseSpeed + 0.154907158558516 * FleetSize)...
    ))...
    ) + 7879.4823379179 * tanh(...
    0.5 * ((-10.4663342708787) + -24.0152004442454 *...
    tanh(0.5 * (0.937058060524971 + -0.00599946669774586 * Payload +...
    -0.0297780775975021 * CruiseSpeed + -0.268560898749955 * FleetSize)...
    ) + 11.2279232079849 * tanh(...
    0.5 * ((-0.437664036426991) + 0.0792966702177669 * Payload...
    +0.00548137514862233 * CruiseSpeed + 0.0572969143170224 * FleetSize)...
    ) + 9.13299227523225 * tanh(...
    0.5 * (1.42393947950632 + 0.0109995141437787 * Payload + 0.0229411807146299...
    * CruiseSpeed + 0.154907158558516 * FleetSize)...
    ))...
    ) + -153785.530771219 * tanh(...
    0.5 * (31.336048399874 + -14.8975379251418 * tanh(...
    0.5 * (0.937058060524971 + -0.00599946669774586 * Payload +...
    -0.0297780775975021 * CruiseSpeed + -0.268560898749955 * FleetSize)...
    ) + -58.7045754794311 * tanh(...
    0.5 * ((-0.437664036426991) + 0.0792966702177669 * Payload...
    +0.00548137514862233 * CruiseSpeed + 0.0572969143170224 * FleetSize)...
    ) + -43.3299791021839 * tanh(...
    0.5 * (1.42393947950632 + 0.0109995141437787 * Payload + 0.0229411807146299...
    * CruiseSpeed + 0.154907158558516 * FleetSize) ))) ) +ishift)/(inorm);

TimeSavings = (( (-5714.29475162956) + 7560.63118952762 * tanh(...
    0.5 * ((-1.58419482327373) + -0.186188436352601 *...
    tanh( 0.5 * ((-24.7113797215689) + 0.0858121599432886 * Payload...
    +0.0600068804364254 * CruiseSpeed + 21.9192604760731 * FleetSize)...
    ) + 2.9984044062008 * tanh(...
    0.5 * ((-1.59574151407855) + 0.878545611626667 * Payload...
    +0.0232223339583786 * CruiseSpeed + 0.466162797394308 * FleetSize)...
    ) + 0.343845391457709 * tanh(...
    0.5 * ((-26.3352857761364) + 0.454852283822259 * Payload +...
    -0.662442518729643 * CruiseSpeed + 39.6772783374385 * FleetSize)...
    ))...
    ) + 3445.39163009679 * tanh(...
    0.5 * (3.99517764859861 + 2.44126817665469 * tanh(...
    0.5 * ((-24.7113797215689) + 0.0858121599432886 * Payload...
    +0.0600068804364254 * CruiseSpeed + 21.9192604760731 * FleetSize)...
    ) + -3.94034495464323 * tanh(...
    0.5 * ((-1.59574151407855) + 0.878545611626667 * Payload...
    +0.0232223339583786 * CruiseSpeed + 0.466162797394308 * FleetSize)...
    ) + -1.49106670078921 * tanh(...
    0.5 * ((-26.3352857761364) + 0.454852283822259 * Payload +...
    -0.662442518729643 * CruiseSpeed + 39.6772783374385 * FleetSize)...
    ))) + -7891.47212692129 * tanh(...
    0.5 * ((-10.1047311073469) + 15.6344592736251 *...
    tanh(0.5 * ((-24.7113797215689) + 0.0858121599432886 * Payload...
    +0.0600068804364254 * CruiseSpeed + 21.9192604760731 * FleetSize)...
    ) + -18.391725965585 * tanh(...
    0.5 * ((-1.59574151407855) + 0.878545611626667 * Payload...
    +0.0232223339583786 * CruiseSpeed + 0.466162797394308 * FleetSize)...
    ) + -2.15704754757706 * tanh(...
    0.5 * ((-26.3352857761364) + 0.454852283822259 * Payload +...
    -0.662442518729643 * CruiseSpeed + 39.6772783374385 * FleetSize)))) +tshift)/ (tnorm));

% weight and sum impacts
f = wB * BoatJobLoss + wC * Crops + wF * ForestLoss + wI * Income + wT * TimeSavings;
end


function [c,ceq] = nlc(x)
% No constraints needed to define feasible space since cities are close
%   enough that all designs are feasible
Payload = round(x(1));
CruiseSpeed = round(x(2));
FleetSize = round(x(3));
PayloadFraction = 0.3;
FuelTankFraction = 0.05;
FinenessRatio = 3;
ConstraintSize = 81000;


% footprint constraint
totalLift_lb = 2000 * Payload / PayloadFraction;
liftLbPerCubicFoot = 0.06; % helium
specificDensity = 0.95; % at ~1500 ft
airshipVolume_ft3 = (totalLift_lb / liftLbPerCubicFoot) / specificDensity;
diameter_ft = 0.3048 * (4*airshipVolume_ft3 / (0.6 * pi * FinenessRatio))^(1/3) % m # not using percent cylinder
length_ft = diameter_ft * FinenessRatio % m
footprint_ft2 = length_ft * diameter_ft;

FootprintConstraint = footprint_ft2 * FleetSize * 1.1 - ConstraintSize; % this equivalent to forrestloss being below a size


c(:,1) = FootprintConstraint;
ceq = [];
end




















